<!doctype html>
<html lang="{{ 'en' if language == 'en' else 'es' }}">
<head>
  <meta charset="utf-8" />
  <title>ScooterMania - Financing Price Calculator (Web)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Inline CSS, no static/style.css needed -->
  <style>
    :root {
      --bg-dark: #111111;
      --bg-card-dark: #1e1e1e;
      --bg-light: #f5f5f5;
      --bg-card-light: #ffffff;
      --accent: #c62828;
      --accent-soft: #ff5a5a;
      --text-light: #ffffff;
      --text-dark: #222222;
      --border-radius: 12px;
    }

    * {
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      margin: 0;
      padding: 0;
    }

    body.dark {
      background: var(--bg-dark);
      color: var(--text-light);
    }

    body.light {
      background: var(--bg-light);
      color: var(--text-dark);
    }

    .page {
      max-width: 1024px;
      margin: 0 auto;
      padding: 16px;
    }

    .title {
      text-align: left;
      font-size: 1.4rem;
      font-weight: 700;
      color: var(--accent-soft);
      margin-bottom: 12px;
    }

    .card {
      border-radius: var(--border-radius);
      padding: 16px;
      margin-bottom: 16px;
    }

    body.dark .card {
      background: var(--bg-card-dark);
      box-shadow: 0 0 0 1px #333;
    }

    body.light .card {
      background: var(--bg-card-light);
      box-shadow: 0 0 0 1px #ddd;
    }

    .card-title {
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 10px;
    }

    label {
      font-size: 0.82rem;
      display: block;
      margin-bottom: 4px;
    }

    input[type="text"],
    input[type="number"],
    select {
      width: 100%;
      padding: 8px 10px;
      border-radius: 8px;
      border: 1px solid #555;
      font-size: 0.85rem;
      background: transparent;
      color: inherit;
    }

    body.light input[type="text"],
    body.light input[type="number"],
    body.light select {
      border-color: #bbb;
      background: #ffffff;
      color: #111;
    }

    .row {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .col-50 {
      flex: 1 1 0;
      min-width: 180px;
    }

    .checkbox-row {
      display: flex;
      align-items: center;
      gap: 6px;
      margin: 6px 0 10px 0;
      font-size: 0.8rem;
    }

    .btn-row {
      display: flex;
      gap: 10px;
      margin-top: 12px;
    }

    button {
      border-radius: 999px;
      padding: 8px 18px;
      border: none;
      cursor: pointer;
      font-size: 0.9rem;
      font-weight: 600;
    }

    .btn-accent {
      background: var(--accent);
      color: #fff;
      flex: 1;
    }

    .btn-muted {
      background: #666;
      color: #eee;
      flex: 0 0 120px;
    }

    body.light .btn-muted {
      background: #ddd;
      color: #222;
    }

    button:hover {
      filter: brightness(1.08);
    }

    .logo {
      text-align: center;
      margin-bottom: 10px;
    }

    .logo-text {
      font-weight: 700;
      letter-spacing: 0.04em;
      color: var(--accent-soft);
      font-size: 1.1rem;
    }

    .financing-grid {
      display: grid;
      grid-template-columns: 1.3fr 0.9fr 1.1fr;
      gap: 8px;
      align-items: center;
      font-size: 0.8rem;
    }

    .financing-grid-header {
      font-weight: 600;
      font-size: 0.8rem;
      margin-bottom: 4px;
    }

    .financing-company-label {
      font-size: 0.8rem;
    }

    @media (max-width: 768px) {
      .financing-grid {
        grid-template-columns: 1fr;
      }
    }

    .results {
      font-size: 0.8rem;
      line-height: 1.4;
      margin-top: 6px;
    }

    .results-line {
      display: flex;
      justify-content: space-between;
      gap: 10px;
      margin-bottom: 3px;
    }

    .results-label {
      flex: 1;
    }

    .results-value {
      font-weight: 600;
      white-space: nowrap;
    }

    hr {
      margin: 10px 0;
      border: none;
      height: 1px;
      background: rgba(255, 255, 255, 0.1);
    }

    body.light hr {
      background: rgba(0, 0, 0, 0.08);
    }
  </style>
</head>
<body class="{{ theme }}">
<div class="page">

  <div class="logo">
    <!-- You can replace this with an <img> if you host the PNG somewhere -->
    <div class="logo-text">SCOOTERMANIA</div>
  </div>

  <div class="title">
    ScooterMania – Financing Price Calculator (Web)
  </div>

  <form method="post">
    <!-- Top card: language, theme, core inputs -->
    <div class="card">
      <div class="row">
        <div class="col-50">
          <label>
            {{ 'Language' if language == 'en' else 'Idioma' }}:
          </label>
          <select name="language">
            <option value="en" {% if language == 'en' %}selected{% endif %}>English</option>
            <option value="es" {% if language == 'es' %}selected{% endif %}>Español</option>
          </select>
        </div>
        <div class="col-50">
          <label>
            {{ 'Theme' if language == 'en' else 'Tema' }}:
          </label>
          <select name="theme">
            <option value="dark" {% if theme == 'dark' %}selected{% endif %}>Dark</option>
            <option value="light" {% if theme == 'light' %}selected{% endif %}>Light</option>
          </select>
        </div>
      </div>

      <hr />

      <label>
        {{ 'Total price to customer (incl. shipping):' if language == 'en'
           else 'Precio total al cliente (incl. envío):' }}
      </label>
      <input type="number" step="0.01" name="total_price" value="{{ form.total_price }}" />

      <div class="checkbox-row">
        <input type="checkbox" id="include_shipping" name="include_shipping"
               {% if include_shipping %}checked{% endif %} />
        <label for="include_shipping">
          {{ 'Include fixed shipping $' if language == 'en' else 'Incluir envío fijo $' }}{{ "%.0f"|format(fixed_shipping) }}
          ({{ 'not taxed, not revenue' if language == 'en' else 'sin impuestos, no es ganancia' }})
        </label>
      </div>

      <label>
        {{ 'Tax rate % (FL):' if language == 'en' else 'Impuesto % (Florida):' }}
      </label>
      <input type="number" step="0.01" name="tax_rate" value="{{ form.tax_rate }}" />

      <label>
        {{ 'Manual bank fee % (one or multiple; applies on bike+tax):'
           if language == 'en'
           else 'Comisión bancaria manual % (una o varias; aplicado a moto+impuesto):' }}
      </label>
      <input type="number" step="0.01" name="manual_bank_fee_pct" value="{{ form.manual_bank_fee_pct }}" />

      <label>
        {{ 'Bike cost to you ($):' if language == 'en'
           else 'Costo de la moto para ti ($):' }}
      </label>
      <input type="number" step="0.01" name="bike_cost" value="{{ form.bike_cost }}" />

      <label>
        {{ 'Seller commission ($):' if language == 'en'
           else 'Comisión del vendedor ($):' }}
      </label>
      <input type="number" step="0.01" name="seller_commission" value="{{ form.seller_commission }}" />

      <div class="btn-row">
        <button class="btn-accent" type="submit" name="action" value="calculate">
          {{ 'Calculate' if language == 'en' else 'Calcular' }}
        </button>
        <button class="btn-muted" type="submit" name="action" value="clear">
          {{ 'Clear' if language == 'en' else 'Limpiar' }}
        </button>
      </div>
    </div>

    <!-- Financing companies -->
    <div class="card">
      <div class="card-title">
        {{ 'Financing companies (enter AMOUNT financed for this deal):'
           if language == 'en'
           else 'Financieras (ingrese el MONTO financiado para esta venta):' }}
      </div>

      <div class="financing-grid-header">
        {{ 'Each amount uses that company\'s merchant fee rate.' if language == 'en'
           else 'Cada monto usa el porcentaje de comisión de esa financiera.' }}
      </div>

      <div class="financing-grid" style="margin-top: 8px;">
        <!-- Header labels (desktop only visually, but fine on mobile) -->
        <div class="financing-company-label"><strong>{{ 'Company' if language == 'en' else 'Compañía' }}</strong></div>
        <div><strong>{{ 'Amount financed ($)' if language == 'en' else 'Monto financiado ($)' }}</strong></div>
        <div><strong>{{ 'Rate % (merchant fee)' if language == 'en' else '% comisión' }}</strong></div>

        <!-- American First Finance -->
        <div class="financing-company-label">American First Finance</div>
        <div>
          <input type="number" step="0.01" name="aff_amount" value="{{ form.aff_amount }}" />
        </div>
        <div>
          <input type="number" step="0.01" name="aff_rate" value="{{ form.aff_rate }}" />
        </div>

        <!-- Acima -->
        <div class="financing-company-label">Acima</div>
        <div>
          <input type="number" step="0.01" name="acima_amount" value="{{ form.acima_amount }}" />
        </div>
        <div>
          <input type="number" step="0.01" name="acima_rate" value="{{ form.acima_rate }}" />
        </div>

        <!-- Dignify (dropdown options 6.5 or 9) -->
        <div class="financing-company-label">Dignify</div>
        <div>
          <input type="number" step="0.01" name="dignify_amount" value="{{ form.dignify_amount }}" />
        </div>
        <div>
          <select name="dignify_rate">
            {% for opt in [6.5, 9.0] %}
            <option value="{{ opt }}" {% if form.dignify_rate|float == opt %}selected{% endif %}>
              {{ "%.2f"|format(opt) }}%
            </option>
            {% endfor %}
          </select>
        </div>

        <!-- Synchrony (5, 9, 13.5) -->
        <div class="financing-company-label">Synchrony</div>
        <div>
          <input type="number" step="0.01" name="synchrony_amount" value="{{ form.synchrony_amount }}" />
        </div>
        <div>
          <select name="synchrony_rate">
            {% for opt in [5.0, 9.0, 13.5] %}
            <option value="{{ opt }}" {% if form.synchrony_rate|float == opt %}selected{% endif %}>
              {{ "%.2f"|format(opt) }}%
            </option>
            {% endfor %}
          </select>
        </div>

        <!-- Afterpay -->
        <div class="financing-company-label">Afterpay</div>
        <div>
          <input type="number" step="0.01" name="afterpay_amount" value="{{ form.afterpay_amount }}" />
        </div>
        <div>
          <input type="number" step="0.01" name="afterpay_rate" value="{{ form.afterpay_rate }}" />
        </div>

        <!-- US Bank (5, 8, 10, 12, 14, 16) -->
        <div class="financing-company-label">US Bank</div>
        <div>
          <input type="number" step="0.01" name="usbank_amount" value="{{ form.usbank_amount }}" />
        </div>
        <div>
          <select name="usbank_rate">
            {% for opt in [5.0, 8.0, 10.0, 12.0, 14.0, 16.0] %}
            <option value="{{ opt }}" {% if form.usbank_rate|float == opt %}selected{% endif %}>
              {{ "%.2f"|format(opt) }}%
            </option>
            {% endfor %}
          </select>
        </div>

        <!-- Snap Finance -->
        <div class="financing-company-label">Snap Finance</div>
        <div>
          <input type="number" step="0.01" name="snap_amount" value="{{ form.snap_amount }}" />
        </div>
        <div>
          <input type="number" step="0.01" name="snap_rate" value="{{ form.snap_rate }}" />
        </div>

        <!-- Progressive -->
        <div class="financing-company-label">Progressive</div>
        <div>
          <input type="number" step="0.01" name="progressive_amount" value="{{ form.progressive_amount }}" />
        </div>
        <div>
          <input type="number" step="0.01" name="progressive_rate" value="{{ form.progressive_rate }}" />
        </div>

        <!-- Zip -->
        <div class="financing-company-label">Zip</div>
        <div>
          <input type="number" step="0.01" name="zip_amount" value="{{ form.zip_amount }}" />
        </div>
        <div>
          <input type="number" step="0.01" name="zip_rate" value="{{ form.zip_rate }}" />
        </div>

        <!-- Klarna -->
        <div class="financing-company-label">Klarna</div>
        <div>
          <input type="number" step="0.01" name="klarna_amount" value="{{ form.klarna_amount }}" />
        </div>
        <div>
          <input type="number" step="0.01" name="klarna_rate" value="{{ form.klarna_rate }}" />
        </div>
      </div>
    </div>

    <!-- Results -->
    <div class="card">
      <div class="card-title">
        {{ 'Results' if language == 'en' else 'Resultados' }}
      </div>

      {% if result %}
      <div class="results">
        <div class="results-line">
          <div class="results-label">
            {{ 'Bike price before tax:' if language == 'en'
               else 'Precio de la moto antes de impuestos:' }}
          </div>
          <div class="results-value">${{ "%.2f"|format(result.bike_price_before_tax) }}</div>
        </div>

        <div class="results-line">
          <div class="results-label">
            {{ 'Tax amount:' if language == 'en' else 'Monto de impuestos:' }}
          </div>
          <div class="results-value">${{ "%.2f"|format(result.tax_amount) }}</div>
        </div>

        <div class="results-line">
          <div class="results-label">
            {{ 'Subtotal with tax (bike only):' if language == 'en'
               else 'Subtotal con impuestos (solo moto):' }}
          </div>
          <div class="results-value">${{ "%.2f"|format(result.subtotal_with_tax_bike_only) }}</div>
        </div>

        <div class="results-line">
          <div class="results-label">
            {{ 'Shipping (not taxed, not revenue):' if language == 'en'
               else 'Envío (sin impuestos, no es ganancia):' }}
          </div>
          <div class="results-value">${{ "%.2f"|format(result.shipping_amount) }}</div>
        </div>

        <div class="results-line">
          <div class="results-label">
            {{ 'Cash total to customer (bike + tax + shipping):' if language == 'en'
               else 'Total al cliente (moto + impuestos + envío):' }}
          </div>
          <div class="results-value">${{ "%.2f"|format(result.total_to_customer) }}</div>
        </div>

        <hr />

        <div class="results-line">
          <div class="results-label">
            {{ 'Bank fee breakdown:' if language == 'en'
               else 'Detalle de comisiones bancarias:' }}
          </div>
          <div class="results-value" style="white-space: normal; text-align: right;">
            {{ result.bank_breakdown_str }}
          </div>
        </div>

        <div class="results-line">
          <div class="results-label">
            {{ 'Total bank fees (all companies):' if language == 'en'
               else 'Total comisiones bancarias:' }}
          </div>
          <div class="results-value">
            ${{ "%.2f"|format(result.total_bank_fees_dollars) }}
          </div>
        </div>

        <div class="results-line">
          <div class="results-label">
            {{ 'Total bank fees vs bike+tax (%):' if language == 'en'
               else 'Comisiones totales vs moto+impuesto (%):' }}
          </div>
          <div class="results-value">
            {{ "%.2f"|format(result.total_bank_fee_pct_vs_bike) }}%
          </div>
        </div>

        <hr />

        <div class="results-line">
          <div class="results-label">
            {{ '[If you DO NOT pass fees] Net to store (bike only):'
               if language == 'en'
               else '[Si NO pasas las comisiones] Neto para la tienda (solo moto):' }}
          </div>
          <div class="results-value">
            ${{ "%.2f"|format(result.net_to_store_no_pass_bike_only) }}
          </div>
        </div>

        <div class="results-line">
          <div class="results-label">
            {{ '[If you DO NOT pass fees] Profit after commission:'
               if language == 'en'
               else '[Si NO pasas las comisiones] Ganancia después de comisión:' }}
          </div>
          <div class="results-value">
            ${{ "%.2f"|format(result.profit_no_pass) }}
          </div>
        </div>

        <hr />

        <div class="results-line">
          <div class="results-label">
            {{ '[If you PASS fees] Customer price (incl. shipping):'
               if language == 'en'
               else '[Si PASAS las comisiones] Precio al cliente (incl. envío):' }}
          </div>
          <div class="results-value">
            ${{ "%.2f"|format(result.customer_price_pass) }}
          </div>
        </div>

        <div class="results-line">
          <div class="results-label">
            {{ '[If you PASS fees] Net to store (bike only):'
               if language == 'en'
               else '[Si PASAS las comisiones] Neto para la tienda (solo moto):' }}
          </div>
          <div class="results-value">
            ${{ "%.2f"|format(result.net_to_store_pass_bike_only) }}
          </div>
        </div>

        <div class="results-line">
          <div class="results-label">
            {{ '[If you PASS fees] Profit after commission:'
               if language == 'en'
               else '[Si PASAS las comisiones] Ganancia después de comisión:' }}
          </div>
          <div class="results-value">
            ${{ "%.2f"|format(result.profit_pass) }}
          </div>
        </div>
      </div>
      {% else %}
      <div style="font-size: 0.8rem; opacity: 0.8;">
        {{ 'Enter values above and press Calculate.' if language == 'en'
           else 'Ingresa los valores arriba y presiona Calcular.' }}
      </div>
      {% endif %}
    </div>
  </form>
</div>
</body>
</html>
