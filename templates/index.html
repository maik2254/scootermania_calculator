<!DOCTYPE html>
<html lang="{{ 'en' if lang == 'en' else 'es' }}">
<head>
    <meta charset="UTF-8">
    <title>{{ strings.title }}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        :root {
            --sm-red: #e85a3c;
            --sm-red-dark: #bf4329;
            --bg-dark: #111111;
            --bg-light: #f4f4f4;
            --card-dark: #1c1c1f;
            --card-light: #ffffff;
            --text-light: #ffffff;
            --text-dark: #1b1b1b;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-light);
        }

        body.light {
            background-color: var(--bg-light);
            color: var(--text-dark);
        }

        .wrapper {
            max-width: 1150px;
            margin: 0 auto;
            padding: 24px 16px 48px;
        }

        header {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 24px;
            flex-wrap: wrap;
        }

        header img.logo {
            height: 48px;
            width: auto;
        }

        header h1 {
            font-size: 1.8rem;
            font-weight: 700;
            margin: 0;
            color: var(--sm-red);
        }

        .card {
            background-color: var(--card-dark);
            border-radius: 16px;
            padding: 20px 18px 24px;
            box-shadow: 0 18px 45px rgba(0, 0, 0, 0.35);
        }

        body.light .card {
            background-color: var(--card-light);
            box-shadow: 0 12px 28px rgba(0, 0, 0, 0.12);
        }

        .grid-2 {
            display: grid;
            grid-template-columns: minmax(0, 1fr) minmax(0, 1fr);
            gap: 16px;
        }

        .field-group {
            margin-bottom: 14px;
        }

        label {
            display: block;
            font-size: 0.9rem;
            margin-bottom: 4px;
        }

        .input, select {
            width: 100%;
            box-sizing: border-box;
            border-radius: 10px;
            border: 1px solid #444;
            padding: 10px 12px;
            background: #151518;
            color: #f5f5f5;
            font-size: 0.95rem;
        }

        body.light .input,
        body.light select {
            background: #fdfdfd;
            border-color: #ccc;
            color: #111;
        }

        .input[readonly] {
            opacity: 0.7;
            cursor: default;
        }

        .checkbox-row {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 10px;
        }

        .checkbox-row input[type="checkbox"] {
            transform: scale(1.1);
        }

        .button-row {
            display: flex;
            gap: 12px;
            margin-top: 16px;
        }

        .btn {
            flex: 1;
            border-radius: 999px;
            padding: 12px 18px;
            border: none;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
        }

        .btn-primary {
            background: var(--sm-red);
            color: white;
        }

        .btn-primary:hover {
            background: var(--sm-red-dark);
        }

        .btn-outline {
            background: transparent;
            border: 1px solid #666;
            color: inherit;
        }

        .section-title {
            margin: 22px 0 6px;
            font-size: 1.05rem;
            font-weight: 600;
            color: var(--sm-red);
        }

        .section-subtitle {
            font-size: 0.85rem;
            margin-bottom: 12px;
            opacity: 0.8;
        }

        .banks-grid {
            display: grid;
            grid-template-columns: minmax(0, 1.4fr) minmax(0, 0.8fr) minmax(0, 0.8fr);
            gap: 10px 12px;
            align-items: center;
        }

        .banks-header {
            font-size: 0.8rem;
            opacity: 0.8;
            margin-bottom: 4px;
        }

        .bank-name {
            font-size: 0.9rem;
        }

        .results-card {
            margin-top: 20px;
            padding: 16px 16px 18px;
            border-radius: 14px;
            background: rgba(0, 0, 0, 0.4);
        }

        body.light .results-card {
            background: #fafafa;
        }

        .results-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--sm-red);
        }

        .results-list {
            margin: 0;
            padding-left: 20px;
            font-size: 0.9rem;
        }

        .results-list li + li {
            margin-top: 3px;
        }

        @media (max-width: 900px) {
            .banks-grid {
                grid-template-columns: minmax(0, 1.3fr) minmax(0, 1fr) minmax(0, 1fr);
            }
        }

        @media (max-width: 720px) {
            .grid-2 {
                grid-template-columns: minmax(0, 1fr);
            }

            .banks-grid {
                grid-template-columns: minmax(0, 1.3fr) minmax(0, 1fr);
            }

            .banks-grid .rate-col-header {
                display: none;
            }
        }

        @media (max-width: 520px) {
            header h1 {
                font-size: 1.35rem;
            }

            .wrapper {
                padding-inline: 10px;
            }
        }
    </style>
</head>
<body class="{{ 'light' if theme == 'light' else 'dark' }}">
<div class="wrapper">
    <header>
        <!-- Logo now served from /static -->
        <img src="{{ url_for('static', filename='scootermania_logo.png') }}"
             alt="ScooterMania" class="logo">
        <h1>{{ strings.title }}</h1>
    </header>

    <div class="card">
        <form method="post">
            <div class="grid-2">
                <div class="field-group">
                    <label for="language">{{ strings.language_label }}</label>
                    <select id="language" name="language">
                        <option value="en" {% if lang == 'en' %}selected{% endif %}>English</option>
                        <option value="es" {% if lang == 'es' %}selected{% endif %}>Espa√±ol</option>
                    </select>
                </div>

                <div class="field-group">
                    <label for="theme">{{ strings.theme_label }}</label>
                    <select id="theme" name="theme">
                        <option value="dark" {% if theme == 'dark' %}selected{% endif %}>Dark</option>
                        <option value="light" {% if theme == 'light' %}selected{% endif %}>Light</option>
                    </select>
                </div>
            </div>

            <div class="field-group">
                <label for="total_price">{{ strings.total_price_label }}</label>
                <input class="input" id="total_price" name="total_price" type="number" step="0.01"
                       value="{{ form_data.total_price }}">
            </div>

            <div class="checkbox-row">
                <input type="checkbox" id="include_shipping" name="include_shipping"
                       {% if form_data.include_shipping %}checked{% endif %}>
                <label for="include_shipping">{{ strings.shipping_toggle }}</label>
            </div>

            <div class="grid-2">
                <div class="field-group">
                    <label for="tax_rate">{{ strings.tax_rate_label }}</label>
                    <!-- 7% fixed, read-only -->
                    <input class="input" id="tax_rate" type="number" step="0.01"
                           value="{{ tax_rate }}" readonly>
                </div>

                <div class="field-group">
                    <label for="bike_cost">{{ strings.bike_cost_label }}</label>
                    <input class="input" id="bike_cost" name="bike_cost" type="number" step="0.01"
                           value="{{ form_data.bike_cost }}">
                </div>
            </div>

            <div class="field-group">
                <label for="seller_commission">{{ strings.seller_commission_label }}</label>
                <input class="input" id="seller_commission" name="seller_commission" type="number" step="0.01"
                       value="{{ form_data.seller_commission }}">
            </div>

            <div class="button-row">
                <button class="btn btn-primary" type="submit" name="action" value="calculate">
                    {{ strings.calculate }}
                </button>
                <button class="btn btn-outline" type="submit" name="action" value="clear">
                    {{ strings.clear }}
                </button>
            </div>

            <div class="section-title">{{ strings.financing_section_title }}</div>
            <div class="section-subtitle">{{ strings.financing_section_hint }}</div>

            <div class="banks-grid">
                <div class="banks-header">{{ 'Company' if lang == 'en' else 'Financiera' }}</div>
                <div class="banks-header">{{ 'Amount financed ($)' if lang == 'en' else 'Monto financiado ($)' }}</div>
                <div class="banks-header rate-col-header">{{ 'Rate %' if lang == 'en' else '% comerciante' }}</div>

                {% for bank in banks %}
                    <div class="bank-name">
                        {{ bank.name_en if lang == 'en' else bank.name_es }}
                    </div>
                    <div>
                        <input class="input" type="number" step="0.01"
                               name="{{ bank.key }}_amount"
                               value="{{ bank_form[bank.key ~ '_amount'] }}">
                    </div>
                    <div>
                        {% if bank.rate_choices %}
                            <select class="input" name="{{ bank.key }}_rate">
                                {% for choice in bank.rate_choices %}
                                    <option value="{{ choice }}"
                                        {% if bank_rate_values[bank.key ~ '_rate']|float == choice %}selected{% endif %}>
                                        {{ "%.2f%%"|format(choice) }}
                                    </option>
                                {% endfor %}
                            </select>
                        {% else %}
                            <input class="input" type="number" step="0.01"
                                   name="{{ bank.key }}_rate"
                                   value="{{ bank_rate_values[bank.key ~ '_rate'] }}">
                        {% endif %}
                    </div>
                {% endfor %}
            </div>

            {% if results %}
                <div class="results-card">
                    <div class="results-title">{{ strings.results_title }}</div>
                    <ul class="results-list">
                        {% for label, value in results %}
                            <li><strong>{{ label }}</strong> {{ value }}</li>
                        {% endfor %}
                    </ul>
                </div>
            {% endif %}
        </form>
    </div>
</div>
</body>
</html>
